!function(t){var e=t.webkitAudioContext||t.AudioContext;if(!e)throw new Error("No Web Audio API support - cannot initialize Rhombus.");var n={};t.Rhombus=n,n._ctx=new e}(this),function(t){t.Util={},t.Util.noteNum2Freq=function(t){var e=440*Math.pow(2,(t-69)/12);return e}}(this.Rhombus),function(t){function e(){this._playing=!1,this._currentNote=void 0,this._osc=t._ctx.createOscillator(),this._oscGain=t._ctx.createGain(),this._filter=t._ctx.createBiquadFilter(),this._filterGain=t._ctx.createGain(),this._osc.type="square",this._osc.start(0),this._oscGain.gain.value=0,this._filter.type="lowpass",this._filter.frequency.value=0,this._osc.connect(this._oscGain),this._oscGain.connect(this._filter),this._filter.connect(this._filterGain),this._filterGain.connect(t._ctx.destination),this._filterGain.gain.value=.5}e.prototype={noteOn:function(e){if(!(e.getPitch()<0||e.getPitch()>127)){this._playing=!0,this._currentNote=e;var n=t._ctx.currentTime,i=t.Util.noteNum2Freq(e.getPitch());this._osc.frequency.cancelScheduledValues(n),this._filter.frequency.cancelScheduledValues(n),this._oscGain.gain.cancelScheduledValues(n),this._osc.frequency.setValueAtTime(i,t._ctx.currentTime),this._filter.Q.value=3+9*(1-e.getPitch()/127),this._oscGain.gain.linearRampToValueAtTime(.6,n+.005),this._oscGain.gain.linearRampToValueAtTime(.4,n+.1),this._filter.frequency.linearRampToValueAtTime(4e3,n+.005),this._filter.frequency.exponentialRampToValueAtTime(200,n+.25)}},noteOff:function(){this._playing=!1,this._currentNote=void 0,this._oscGain.gain.linearRampToValueAtTime(0,t._ctx.currentTime+.125)},killAllNotes:function(){this._currentNote&&this._noteOff(this.currentNote)}};var n=new e;t.Instrument=n,t.startPreviewNote=function(){},t.stopPreviewNote=function(){}}(this.Rhombus),function(t){t.Note=function(t,e,n){this._pitch=t||60,this._start=e||0,this._length=n||0},t.Note.prototype={getPitch:function(){return this._pitch},setPitch:function(){},getStart:function(){return this._start},setStart:function(){},getLength:function(){return this._length},setLength:function(){},"delete":function(){}},t._song={};var e=t._song;e.notes={},t.getNoteCount=function(){},t.getNote=function(){},t.insertNote=function(){}}(this.Rhombus),function(t){function e(){var t="var scheduleId = false;\nself.onmessage = function(oEvent) {\n  if (oEvent.data.playing === false) {\n    if (scheduleId) {\n      clearTimeout(scheduleId);\n    }\n  } else {\n    triggerSchedule();\n  }\n}\nfunction triggerSchedule() {\n  postMessage(0);\n  scheduleId = setTimeout(triggerSchedule, 10);\n}\n",e=new Blob([t],{type:"application/javascript"});return new Worker(URL.createObjectURL(e))}function n(){console.log("called at: "+t.getPosition())}function i(t){return t/r}function o(t){return t*r}function c(e){return e?t._ctx.currentTime+l:l}var s=e();s.onmessage=n;var r=480,u=120;t.ticks2Seconds=function(t){return i(t)/u*60},t.seconds2Ticks=function(t){var e=t/60*u;return o(e)};var a=!1,l=0;t.startPlayback=function(){a||(a=!0,l-=t._ctx.currentTime,s.postMessage({playing:!0}))},t.stopPlayback=function(){a&&(a=!1,l=c(!0),s.postMessage({playing:!1}))},t.getPosition=function(){return c(a)},t.moveToPositionTicks=function(e){var n=t.ticks2Seconds(e);t.moveToPositionSeconds(n)},t.moveToPositionSeconds=function(e){l=a?e-t._ctx.currentTime:e},t.getLoopEnabled=function(){},t.setLoopEnabled=function(){},t.getLoopStart=function(){},t.setLoopStart=function(){},t.getLoopEnd=function(){},t.setLoopEnd=function(){}}(this.Rhombus);